\usepackage{tikz}
\usepackage{circuitikz}

\usetikzlibrary{calc}

% ---------------
% Example IC
% ---------------
\pgfdeclareshape{ic8pin}{
\anchor{center}{\pgfpointorigin} % (0,0) is the center

\anchor{text}
{\pgfpoint{-0.5\wd\pgfnodeparttextbox}{-.5\ht\pgfnodeparttextbox}}

\savedanchor\icpina{\pgfpoint{-.75cm}{-.625cm}}
\anchor{p1}{\icpina}
\savedanchor\icpinb{\pgfpoint{-.25cm}{-.625cm}} % pin 2
\anchor{p2}{\icpinb}
\savedanchor\icpinc{\pgfpoint{.25cm}{-.625cm}} % pin 3
\anchor{p3}{\icpinc}
\savedanchor\icpind{\pgfpoint{.75cm}{-.625cm}} % pin 4
\anchor{p4}{\icpind}
\savedanchor\icpine{\pgfpoint{.75cm}{.625cm}} % pin 5
\anchor{p5}{\icpine}
\savedanchor\icpinf{\pgfpoint{.25cm}{.625cm}} % pin 6
\anchor{p6}{\icpinf}
\savedanchor\icping{\pgfpoint{-.25cm}{.625cm}} % pin 7
\anchor{p7}{\icping}
\savedanchor\icpinh{\pgfpoint{-.75cm}{.625cm}} % pin 8
\anchor{p8}{\icpinh}


\foregroundpath{ % border and pin numbers are drawn here
\pgfsetlinewidth{0.05cm}
\pgfpathrectanglecorners{\pgfpoint{1cm}{.625cm}}{\pgfpoint{-1cm}{-.625cm}}
\pgfusepath{draw} %draw rectangle
\pgfsetlinewidth{0.03cm}
\pgfpathmoveto{\pgfpoint{-1cm}{-.3cm}}
\pgfpatharc{-90}{90}{.3cm}
\pgfusepath{draw} %draw semicircle
\pgftext[bottom,at={\pgfpoint{-.75cm}{-.55cm}}]{\scriptsize 1}
\pgftext[bottom,at={\pgfpoint{-.25cm}{-.55cm}}]{\scriptsize 2}
\pgftext[bottom,at={\pgfpoint{.25cm}{-.55cm}}]{\scriptsize 3}
\pgftext[bottom,at={\pgfpoint{.75cm}{-.55cm}}]{\scriptsize 4}
\pgftext[top,at={\pgfpoint{.75cm}{.55cm}}]{\scriptsize 5}
\pgftext[top,at={\pgfpoint{.25cm}{.55cm}}]{\scriptsize 6}
\pgftext[top,at={\pgfpoint{-.25cm}{.55cm}}]{\scriptsize 7}
\pgftext[top,at={\pgfpoint{-.75cm}{.55cm}}]{\scriptsize 8}
}}

% ---------------
% D FlipFlop
% ---------------
\pgfpoint{-.625cm}{.6cm}
\pgfgetlastxy{\xd}{\yd}
\pgfpoint{-.625cm}{-.6cm}
\pgfgetlastxy{\xc}{\yc}
\pgfpoint{.625cm}{.6cm}
\pgfgetlastxy{\xq}{\yq}
\pgfpoint{.625cm}{-.6cm}
\pgfgetlastxy{\xqn}{\yqn}
\pgfpoint{-.625cm}{-1cm}
\pgfgetlastxy{\xsw}{\ysw}
\pgfpoint{.625cm}{1cm}
\pgfgetlastxy{\xne}{\yne}

\pgfdeclareshape{dff}{
    \anchor{center}{\pgfpointorigin}

    \savedanchor\pind{\pgfpoint{\xd - 0.5cm}{\yd}}
    \anchor{d}{\pind}
    \savedanchor\pinc{\pgfpoint{\xc - 0.5cm}{\yc}}
    \anchor{c}{\pinc}
    \savedanchor\pinq{\pgfpoint{\xq + 0.5cm}{\yq}}
    \anchor{q}{\pinq}
    \savedanchor\pinnq{\pgfpoint{\xqn + 0.5cm}{\yqn}}
    \anchor{nq}{\pinnq}

    \foregroundpath{
        \pgfsetlinewidth{0.8pt}
        \pgfpathrectanglecorners{\pgfpoint{-.625cm}{-1cm}}{\pgfpoint{.625cm}{1cm}}
        \pgfusepath{draw}

        \pgfsetlinewidth{0.4pt}
        \pgftext[left,at={\pgfpoint{\xd + .1cm}{\yd}}]{\scriptsize $D$}
        \draw (\xd,\yd) -- ++(-0.5cm,0);

        \pgftext[left,at={\pgfpoint{\xc + .1cm}{\yc}}]{\scriptsize $C$}
        \draw (\xc,\yc) -- ++(-0.5cm,0);

        \pgftext[right,at={\pgfpoint{\xq - .1cm}{\yq}}]{\scriptsize $Q$}
        \draw (\xq,\yq) -- ++(0.5cm,0);

        \pgftext[right,at={\pgfpoint{\xqn - .1cm}{\yqn}}]{\scriptsize $\overline{Q}$}
        \draw (\xqn,\yqn) -- ++(0.5cm,0);
    }
}

% ---------------
% MUX
% ---------------
\pgfpoint{-.3cm}{-.55cm}
\pgfgetlastxy{\xl}{\yl}
\pgfpoint{-.3cm}{.55cm}
\pgfgetlastxy{\xu}{\yu}
\pgfpoint{0cm}{0.85cm}
\pgfgetlastxy{\xs}{\ys}
\pgfpoint{.3cm}{0cm}
\pgfgetlastxy{\xout}{\yout}

\pgfdeclareshape{mux}{
    \anchor{center}{\pgfpointorigin}

    \savedanchor\pinl{\pgfpoint{\xl}{\yl}}
    \anchor{l}{\pinl}
    \savedanchor\pinu{\pgfpoint{\xu}{\yu}}
    \anchor{u}{\pinu}
    \savedanchor\pins{\pgfpoint{\xs}{\ys}}
    \anchor{sel}{\pins}
    \savedanchor\pinout{\pgfpoint{\xout}{\yout}}
    \anchor{out}{\pinout}

    \foregroundpath{
        \pgfsetlinewidth{0.8pt}
        \pgfpathmoveto{\pgfpoint{-.3cm}{1cm}}
        \pgfpathlineto{\pgfpoint{-.3cm}{-1cm}}
        \pgfpathlineto{\pgfpoint{.3cm}{-.7cm}}
        \pgfpathlineto{\pgfpoint{.3cm}{.7cm}}
        \pgfpathlineto{\pgfpoint{-.3cm}{1cm}}
        \pgfpathclose
        \pgfusepath{draw}

        \pgfsetlinewidth{0.4pt}
        \pgftext[left,at={\pgfpoint{\xl + 0.1cm}{\yl}}]{\scriptsize $1$}
        \draw (\xl,\yl) -- ++(-0.5cm,0);
        \pgftext[left,at={\pgfpoint{\xu + 0.1cm}{\yu}}]{\scriptsize $0$}
        \draw (\xu,\yu) -- ++(-0.5cm,0);

        \draw (\xout,\yout) -- ++(0.5cm,0);
        \draw (\xs,\ys) -- ++(0,0.5cm);
    }
}
